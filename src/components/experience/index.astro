---
import type { Props } from "./props";

const { dates, title, company, companyUrl, description, technologies, logo, id, images = [] } =
  Astro.props;

// Función para obtener el icono de una tecnología
function getTechIcon(tech: string): string | null {
  const techIconMap: Record<string, string> = {
    'Flutter': '/tech-icons/flutter.png',
    'Dart': '/tech-icons/flutter.png',
    'TensorFlow Lite': '/tech-icons/python.svg',
    'YOLO': '/tech-icons/python.svg',
    'Unity': '/tech-icons/unity.png',
    'C#': '/tech-icons/csharp.png',
    'Google Cloud': '/tech-icons/google-cloud.png',
    'Gemini AI': '/tech-icons/google-cloud.png',
    'Google Sign-In': '/tech-icons/google-cloud.png',
    'Firebase': '/tech-icons/google-cloud.png',
    'React': '/tech-icons/react.svg',
    'Node.js': '/tech-icons/nodejs.svg',
    'JavaScript': '/tech-icons/javascript.svg',
    'HTML': '/tech-icons/html.svg',
    'CSS': '/tech-icons/css.png',
    'PHP': '/tech-icons/php.png',
    'MySQL': '/tech-icons/mysql.svg',
    'Python': '/tech-icons/python.svg',
    'AWS': '/tech-icons/aws.png',
    'Git': '/tech-icons/git.svg',
    'GitHub': '/tech-icons/git.svg',
    'Jira': '/tech-icons/jira.png',
    'Express': '/tech-icons/nodejs.svg',
    'JSX': '/tech-icons/react.svg',
    'Axios': '/tech-icons/javascript.svg',
    'Bootstrap': '/tech-icons/css.png',
    'Tailwind': '/tech-icons/tailwind.svg',
    'Astro': '/tech-icons/astro.png',
    'Vite': '/tech-icons/vite.png',
    'Scrum': '/tech-icons/jira.png',
    'Progress': '/tech-icons/msoffice.png',
    'MS Office': '/tech-icons/msoffice.png',
    'Laragon': '/tech-icons/laragon.png',
    'Visual Studio': '/tech-icons/csharp.png',
  };
  return techIconMap[tech] || null;
}
---

<li class={`experience-item ${images.length > 0 ? 'experience-with-images' : ''}`}>
  <div
    class={`group relative grid pb-1 sm:grid-cols-8 sm:gap-8 md:gap-4 lg:hover:!opacity-100 lg:group-hover/list:opacity-50 ${images.length > 0 ? 'cursor-pointer' : ''}`}
    data-experience-id={id || ''}
    data-experience-title={title}
    data-experience-images={images.length > 0 ? JSON.stringify(images) : '[]'}
  >
    <div
      class="absolute -inset-x-4 -inset-y-4 z-0 hidden rounded-2xl lg:-inset-x-6 lg:block lg:group-hover:bg-violet-900/10 lg:group-hover:border lg:group-hover:border-violet-500/20"
    >
    </div>
    <header
      class="z-10 mb-2 mt-1 text-xs font-mono font-semibold uppercase tracking-wide text-violet-400/70 sm:col-span-2"
      aria-label={dates}
    >
      <span>{dates}</span>
    </header>
    <div class="z-10 sm:col-span-6">
      <h3 class="font-medium leading-snug">
        <div>
          <div class="inline-flex items-baseline font-medium leading-tight text-slate-200 text-base">
            <div class="flex gap-x-3 items-center flex-wrap">
              {
                logo && (
                  <img
                    class="w-10 h-10 rounded-lg bg-violet-500/10 border border-violet-500/20 p-1"
                    src={logo}
                    alt={`${company} logo`}
                  />
                )
              }
              <span class="flex items-center gap-2 flex-wrap">
                <span>
                  <span class="experience-title" data-i18n={`exp-title-${id || ''}`}>{title}</span>
                  <span class="text-violet-400/60"> · </span>
                  <span class="inline-block text-cyan-300/80">
                    {company}
                  </span>
                  {!companyUrl && (
                    <span class="text-xs text-slate-500/70 ml-2 italic" data-i18n="exp-private-project">
                      (Sistema interno)
                    </span>
                  )}
                </span>
                {images.length > 0 && (
                  <span class="text-xs text-violet-400 flex items-center gap-1.5 px-2 py-1 rounded-full bg-violet-500/10 border border-violet-500/20">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span>{images.length}</span>
                  </span>
                )}
              </span>
            </div>
          </div>
        </div>
      </h3>
      <p class="mt-3 text-sm leading-relaxed text-slate-400 experience-description" data-i18n={`exp-desc-${id || ''}`}>
        {description}
      </p>
      {
        technologies.length && (
          <ul class="mt-4 flex flex-wrap gap-2" aria-label="Technologies used">
            {technologies.map((technology) => {
              const iconPath = getTechIcon(technology);
              return (
                <li>
                  <div class="flex items-center rounded-full border border-violet-500/20 bg-violet-500/10 px-3 py-1 text-xs font-medium leading-5 text-violet-300 gap-1.5">
                    {iconPath && (
                      <img src={iconPath} alt={technology} class="w-3.5 h-3.5 object-contain" />
                    )}
                    {technology}
                  </div>
                </li>
              );
            })}
          </ul>
        )
      }
    </div>
  </div>
</li>

<style>
  .experience-item {
    position: relative;
    padding-left: 1rem;
  }

  .experience-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0.5rem;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: linear-gradient(135deg, #8b5cf6, #06b6d4);
  }

  .experience-item::after {
    content: '';
    position: absolute;
    left: 2px;
    top: 1rem;
    width: 2px;
    height: calc(100% - 0.5rem);
    background: linear-gradient(180deg, rgba(139, 92, 246, 0.3), transparent);
  }

  .experience-item:last-child::after {
    display: none;
  }

  .experience-with-images > div {
    transition: all 0.3s ease;
  }

  .experience-with-images > div:hover {
    transform: translateX(4px);
  }

  .experience-with-images > div:hover .absolute {
    background: rgba(139, 92, 246, 0.15);
    border-color: rgba(139, 92, 246, 0.3);
  }

  .experience-with-images > div.clicking {
    transform: scale(0.98);
  }
</style>
